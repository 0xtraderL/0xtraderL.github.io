---
layout: post
title: "Sui에서 LP 자동 리밸런싱 도구"
date: 2025-6-28 12:00:00 +0800
categories: [DeFi]
tags: [defi, bluefin, sui, clmm]
lang: ko
---

집중 유동성 풀에서 LP를 구성하여 수수료 수익을 얻을 때, 가격이 범위를 벗어나는 상황, 즉 LP 유동성 포지션의 가격 범위를 벗어나는 경우를 자주 접하게 됩니다. 이 경우 수동으로 포지션을 재구축하지 않으면 수익을 얻을 수 없습니다. 수동 포지션 리밸런싱은 다소 번거롭습니다. 투입 자금이 변하지 않는다고 가정하고, 기존 포지션의 남은 토큰 수량을 기준으로 계산하면:

1. 기존 포지션을 닫고 모든 유동성을 인출 - 이 거래에는 1번의 서명이 필요합니다.
2. 새로운 포지션의 가격 범위를 고려하여 필요한 토큰 A와 B의 양을 계산하고, 해당 양의 A 또는 B를 스왑 - 이 스왑 거래에는 1번의 서명이 필요합니다.
3. 2단계에서 얻은 양과 미리 설정된 가격 범위를 기준으로 유동성을 재추가하여 포지션을 구축 - 이는 1번의 서명이 필요합니다.

수동 LP 리밸런싱에는 위의 3단계가 필요하며, 2단계는 도구 없이는 계산하기 어렵습니다. 현재 AlphaFi와 같은 많은 자동 균형 조정 온체인 프로토콜이 있어 범위를 벗어났을 때 자동으로 균형을 맞출 수 있지만, 가격 범위는 프로토콜에 의해 결정되며 자신의 전략에 따라 조정할 수 없습니다. 일반적으로 가격 범위가 매우 크고 소수의 주요 풀에만 적용되어 번거로움을 피하려는 게으른 사용자에게 적합합니다. 저는 이런 프로토콜을 거의 사용하지 않습니다.

## Sui PTB 기능으로 원클릭 리밸런싱 구현

이더리움에서는 온체인 컨트랙트를 사용하지 않고 오프체인에서 이 문제를 해결하는 방법을 정말 모르겠습니다. 하지만 Sui에서는 이 문제가 문제가 아닙니다. 여기서 Sui를 칭찬하겠습니다 - Sui는 실제 문제를 해결하기 위해 태어난 블록체인이며, 다양한 애플리케이션 개발에 매우 적합하고, 가스 비용이 낮고, 보안성이 높고, 속도도 빠르며, 후원 거래, ZkLogin, PTB 프로그래밍 등 많은 기능이 있어 사용자 친화적이고 혁신적인 앱을 쉽게 구현할 수 있습니다.

PTB 기능에 초점을 맞춰 보겠습니다. 이는 정말 강력합니다:

PTB(Programmable Transaction Block)는 간단히 말해, 오프체인에서 트랜잭션을 구축할 때 여러 작업을 한 번에 패키징할 수 있다는 의미입니다. 평범해 보이지만 실제 응용 시나리오는 매우 광범위합니다.

**기존 온체인 작업의 문제점:**
- 복잡한 작업을 여러 독립적인 트랜잭션으로 분해해야 함
- 각 트랜잭션마다 별도의 서명 확인이 필요하여 프로세스가 번거로움
- 어떤 단계든 실패하면 이전 작업이 이미 실행되었을 수 있음
- 가스 수수료가 누적되어 비용이 높아짐

**PTB의 장점:**
- 여러 작업을 오프체인에서 하나의 트랜잭션 블록으로 조립
- 한 번의 서명으로 모두 성공하거나 모두 실패
- 원자적 실행으로 중간 상태 방지
- 본질적으로 단일 트랜잭션이므로 가스 수수료가 크게 절감됨

실제 예시: LP 리밸런싱 작업, 기존 EVM 방식에서는:
1. 유동성 인출 → 서명 확인 → 대기
2. 토큰 스왑으로 비율 조정 → 서명 확인 → 대기
3. 유동성 재추가 → 서명 확인 → 대기

PTB 사용시:
1. 오프체인 구축:
   - 포지션을 닫고 유동성을 인출하여 인출된 토큰 양 획득 (트랜잭션이 아직 실행되지 않았고, 토큰은 여전히 이 트랜잭션 내에 있어 다음 작업으로 전달 가능)
   - 이전 단계의 토큰 양을 기준으로 스왑
   - 스왑 단계의 양을 기준으로 포지션 재생성
2. 위의 트랜잭션을 한 번의 서명으로 제출
3. 온체인에서 원자적 실행

PTB를 사용하면 오프체인에서 플래시론 차익거래도 수행할 수 있습니다. 이는 이더리움 시스템에서는 컨트랙트를 개발해야만 가능한 것입니다.

이것이 제가 Sui에서 원클릭 리밸런싱을 구현할 수 있는 이유이며, 다른 체인에서는 이런 작업의 비용과 복잡성이 높은 이유입니다.

## 나의 워크플로우

1. 자금을 투입하여 처음으로 포지션 생성
2. 포지션 상태를 모니터링하고, 범위를 벗어나면 텔레그램 알림 발송
3. 범위를 벗어난 후, 리밸런싱 워크플로우를 사용하여 기존 포지션이 현재 가격 범위에서 계속 수익을 얻도록 함
4. 역사적 포지션 수익을 관찰하고 포지션의 가격 변동폭을 조정

LP 수익 통계:
![LP 수익 통계](/assets/img/posts/2025-06-28/1.webp)

LP 리밸런싱 실행 과정:
![LP 리밸런싱 실행 과정](/assets/img/posts/2025-06-28/3.png)

사용한 워크플로우 도구:

- 포지션 범위 이탈 모니터링
- 원클릭 리밸런싱
  - [Bluefin](https://app.kamechan.xyz/workflow/traderL/bluefin-spot-automated-percentage-based-rebalancing)
  - [Momentum](https://app.kamechan.xyz/workflow/traderL/mmt-automated-liquidity-position-rebalancing)
- 역사적 포지션 수익 (LP vs Holding)
  - [Bluefin](https://app.kamechan.xyz/workflow/traderL/bluefin-spot-yield-comparison-lp-vs-holding)
  - [Momentum](https://app.kamechan.xyz/workflow/traderL/momentum-pool-yield-comparison-lp-vs-holding) 